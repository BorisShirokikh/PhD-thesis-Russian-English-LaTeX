\newif\ifsynopsis           % Условие, проверяющее, что документ --- автореферат


%%% Основные пакеты %%%
\usepackage{etoolbox}  % для проверки условий, оставляем для возможного расширения
\usepackage{comment}   % для возможности исключать блоки текста


%%% Поля и разметка страницы %%%
\usepackage{geometry}  % задание полей
\usepackage{pdflscape} % альбомные страницы с корректной ориентацией PDF
% \usepackage{lscape} % простая альбомная ориентация


%%% Математика %%%
\usepackage{amsmath,amssymb,amsfonts,amsthm,amscd}
\usepackage{mathtools}  % multlined и др.
\usepackage{xfrac}      % красивые дроби
\usepackage[
locale = DE,
list-separator       = {;\,},
list-final-separator = {;\,},
list-pair-separator  = {;\,},
list-units           = single,
range-units          = single,
range-phrase={\text{\ensuremath{-}}},
fraction-function    = \sfrac,
separate-uncertainty,
]{siunitx}[=v2]
\sisetup{inter-unit-product = \ensuremath{{}\cdot{}}}


%%%% Установки для размера шрифта 14 pt %%%%
%% Формирование переменных и констант для сравнения (один раз для всех подключаемых файлов)%%
%% должно располагаться до вызова пакета fontspec или polyglossia, потому что они сбивают его работу
\newlength{\curtextsize}
\newlength{\bigtextsize}
\setlength{\bigtextsize}{13.9pt}

\makeatletter
%\show\f@size    % неплохо для отслеживания, но вызывает стопорение процесса,
% если документ компилируется без команды  -interaction=nonstopmode
\setlength{\curtextsize}{\f@size pt}
\makeatother


%%% Кодировки и шрифты %%%
\usepackage{polyglossia}         % поддержка многоязычности
\setmainlanguage{english}        % основной язык
\setotherlanguage{russian}       % если вдруг нужен русский

\PassOptionsToPackage{no-math}{fontspec} % опция для fontspec, если нужны математические шрифты
\usepackage{fontspec} % шрифты для XeLaTeX

% Базовые шрифты (обычно нужно скачивать):
\setmainfont{Times New Roman} % ГОСТовский стандартный шрифт
\setsansfont{Arial}
\setmonofont{Courier New}[Scale=0.87] % подгоняет высоту под основной текст (по версии ChatGPT)
% Обеспечиваем кириллицу для этих семейств
\newfontfamily\cyrillicfont{Times New Roman}
\newfontfamily\cyrillicfontsf{Arial}
\newfontfamily\cyrillicfonttt{Courier New}[Scale=0.87]

% Публично доступные аналоги в Debian/Ubuntu:
%\setmainfont{Liberation Serif} % альтернативный свободный аналог Times
%\setsansfont{Liberation Sans}
%\setmonofont{Liberation Mono}[Scale=0.87]
%% Обеспечиваем кириллицу для этих семейств
%\newfontfamily\cyrillicfont{Liberation Serif}
%\newfontfamily\cyrillicfontsf{Liberation Sans}
%\newfontfamily\cyrillicfonttt{Liberation Mono}[Scale=0.87]


%%% Абзацы %%%
\indentafterchapter  % Красная строка после заголовков типа chapter
\usepackage{indentfirst}  % Отступ в первом абзаце после секций/глав
% TODO: как будто после секций не работает


%%% Цвета (если нужно для таблиц/графиков) %%%
\usepackage[dvipsnames]{xcolor}


%%% Таблицы %%%
\usepackage{longtable,ltcaption} % Длинные таблицы
\usepackage{multirow,makecell}   % Улучшенное форматирование таблиц
\usepackage{tabu, tabulary}      % таблицы с автоматически подбирающейся
% шириной столбцов (tabu обязательно
% до hyperref вызывать)

\makeatletter
%https://github.com/tabu-issues-for-future-maintainer/tabu/issues/26
\@ifpackagelater{longtable}{2020/02/07}{
	\def\tabuendlongtrial{%
		\LT@echunk  \global\setbox\LT@gbox \hbox{\unhbox\LT@gbox}\kern\wd\LT@gbox
		\LT@get@widths
	}%
}{}
\makeatother

\usepackage{threeparttable}      % автоматический подгон ширины подписи таблицы


%%% Общие утилиты %%%
%\usepackage{soulutf8}	% soulutf8.sty: warning: 29: This package is obsolete, use the soul package directly.
\usepackage{soul}		% Поддержка переносоустойчивых подчёркиваний и зачёркиваний
\usepackage{icomma}  	% Запятая в десятичных дробях
\usepackage[hyphenation,lastparline]{impnattypo} % Оптимизация расстановки переносов и длины последней строки абзаца


%%% Гиперссылки %%%
\let\CYRDZE\relax
%\usepackage[draft]{hyperref}
\usepackage{hyperref}
%\usepackage{hyperref}%[2012/11/06]


%%% Изображения %%%
\usepackage{graphicx}%[2014/04/25]  % Подключаем пакет работы с графикой
\usepackage{caption}                % Подписи рисунков и таблиц
\usepackage{subcaption}             % Подписи подрисунков и подтаблиц
\usepackage{pdfpages}               % Добавление внешних pdf файлов
\usepackage[export]{adjustbox}


%%% Счётчики %%%
\usepackage{aliascnt}
\usepackage[figure,table]{totalcount}   % Счётчик рисунков и таблиц
\usepackage{totcount}   % Пакет создания счётчиков на основе последнего номера
% подсчитываемого элемента (может требовать дважды
% компилировать документ)
% \usepackage{totpages}   % Счётчик страниц, совместимый с hyperref (ссылается
% на номер последней страницы). Желательно ставить
% последним пакетом в преамбуле


%%% Продвинутое управление групповыми ссылками (пока только формулами) %%%
\usepackage{cleveref}   % продвинутое управление ссылками
\usepackage{kvsetkeys}  % для корректной обработки пробелов в \label
% Добавление возможности использования пробелов в \labelcref
% https://tex.stackexchange.com/a/340502/104425
\makeatletter
\let\org@@cref\@cref
\renewcommand*{\@cref}[2]{%
	\edef\process@me{%
		\noexpand\org@@cref{#1}{\zap@space#2 \@empty}%
	}\process@me
}
\makeatother

\usepackage{placeins} % для \FloatBarrier


%%% User-specific packages %%%
\usepackage{upgreek} % прямые греческие ради русской традиции
\usepackage{pifont}         % adds nice "v" and "x" symbols
\usepackage{bbm}
%\usepackage[ruled]{algorithm2e}