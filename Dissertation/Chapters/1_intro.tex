

\addcontentsline{toc}{chapter}{Introduction}
\chapter*{Introduction}
\label{chap:Introduction}


\underline{\textbf{The relevance of the research area. The degree of its development.}}
The rapid advancements in Deep Learning (DL) have established a strong foundation for automating medical image segmentation tasks~\cite{lee2017deep}. Segmentation algorithms, particularly those based on Convolutional Neural Networks (CNNs), have achieved near human-level performance across a variety of clinical applications, including brain tumor, lung cancer, organ-at-risk, and liver tumor segmentation. These algorithms continue to evolve, offering increasingly accurate results.

%In our previous work, we have demonstrated the practical impact of carefully developed DL methods in real clinical workflows. For instance, we contributed to the radiotherapeutic delineation process at the Moscow Gamma-Knife Center by developing a model that provides accurate brain metastases segmentation contours~\cite{shirokikh2022systematic}. Additionally, our work on automatic COVID-19 identification and severity triage has been successfully integrated into the Moscow healthcare system, streamlining patient management~\cite{goncharov2021ct,covid-program}.

A major focus of our research was to evaluate and integrate DL methods into real-world clinical workflows. One of the earliest examples is the deployment of an automatic segmentation system for stereotactic radiosurgery of brain metastases at the Moscow Gamma Knife Center~\cite{shirokikh2022systematic}. Radiosurgery demands submillimeter precision in target delineation, where even minor variability between specialists can affect the radiation dose distribution and, consequently, treatment outcomes. The developed CNN-based segmentation model significantly improved the clinical workflow by reducing inter-rater detection disagreements by 48\%, enhancing contouring consistency (surface Dice score increased from 0.845 to 0.871), and halving the delineation time. The model was validated through a prospective clinical study involving four experts and twenty patients, showing its potential as a reliable assistant in radiosurgical planning. This work demonstrated that DL-based tools can yield measurable improvements in diagnostic precision and efficiency, highlighting their immediate clinical applicability and setting a methodological precedent for future clinical evaluations of DL systems.

Another practically oriented line of research addressed the COVID-19 pandemic, during which the radiology departments of Moscow healthcare institutions faced extreme diagnostic loads. In collaboration with the Research and Practical Clinical Center for Diagnostics and Telemedicine Technologies, we developed a DL-based triage system for chest CT scans~\cite{goncharov2021ct,covid-program}. The proposed multitask convolutional network jointly performed COVID-19 identification and severity quantification, effectively prioritizing patients for urgent care. Trained on approximately 1500 CT studies and evaluated on an independent test set of 123 studies, the model achieved ROC AUC scores up to 0.97 for COVID-19 identification versus healthy controls and a 0.97 Spearman correlation for severity estimation. This system was successfully integrated into the Moscow healthcare workflow, accelerating patient sorting and resource allocation during the pandemic.% Beyond its immediate public health value, the project demonstrated the robustness and adaptability of DL systems in large-scale, heterogeneous medical environments.

These two implementations -- one in precision radiosurgery, the other in large-scale public healthcare -- demonstrate the high clinical relevance and transformative potential of DL methods in medical imaging.

Despite these successes, the widespread adoption of DL in medical imaging remains hindered by the significant drop in neural network performance when applied to data that differs from the training set. This challenge, known as \textbf{domain shift}, is particularly prevalent in medical imaging due to variations in scanner acquisition parameters, the introduction of new imaging modalities, and differences in patient populations. Our research has highlighted severe performance degradation due to domain shifts in tasks such as brain segmentation from Magnetic Resonance Imaging (MRI)~\cite{shirokikh2020first,zakazov2021anatomy}, COVID-19 segmentation from chest Computer Tomography (CT)~\cite{saparov2021zero,shimovolos2022adaptation} images, and several others~\cite{vasiliuk2023limitations,shirokikh2025m3da}.

Addressing these distributional differences between training and testing data is essential, requiring the development of robust Domain Adaptation (DA) methods. Although the importance of developing DA methods specifically in medical imaging has been emphasized in numerous studies~\cite{gulrajani2020search,uda_survey_2020,zhuang2020comprehensive,peng2018visda,zhang2021empirical}, we outline several critical gaps remaining in the literature.

One such gap is the lack of robustness to particular types of domain shifts, including variations in MRI intensity distributions, CT reconstruction kernels, radiation dosages, and presence/absence of the contrast agents. We systematically investigate these challenges and propose novel DA methods either tailored to specific domain shift scenarios or applied universally across all of them.

Additionally, we note the lack of standardized DA evaluation in 3D medical imaging. To this end, we propose the M3DA benchmark, a large-scale framework designed to comprehensively assess DA methods across multiple, clinically relevant domain shift scenarios, filling a crucial gap in the field. We also publish the Burdenko's Glioblastoma Progression (BGP) dataset, a systematic and annotated data collection for glioblastoma segmentation, enabling in-the-wild DA evaluation in highly heterogeneous clinical data.

To summarize, this thesis is dedicated to developing novel methods, constructing standardized benchmarks, and expanding publicly available datasets in the field of domain adaptation in 3D medical image segmentation, bringing DL models closer to robust, real-world clinical deployment.


%\paragraph{Relevance of the work.}
%
%
%The aforementioned DL advancements hold immense potential for improving diagnostic accuracy, reducing human error, and enhancing the overall efficiency of healthcare systems. However, the clinical application of DL models is significantly challenged by their susceptibility to domain shifts -- variations between the data on which models are trained and the data encountered in real-world clinical environments. Such shifts lead to a dramatic decline in model performance.
%
%This work directly addresses the issue of domain shift in 3D medical image segmentation, contributing to the development of more robust and generalizable DL models. The methods proposed in this thesis, such as SpotTUnet, FBPAug, and F-Consistency, are designed to mitigate the adverse effects, ensuring that segmentation models maintain their accuracy on the target domains. Moreover, the introduction of new adaptation techniques, DA and Out-of-Distribution (OOD) benchmarks, and the annotated publicly available dataset for 3D medical imaging fills significant gaps in the current literature.


\underline{\textbf{Goals and problems addressed.}}
The primary goal of this thesis is to address the challenges posed by domain shifts in 3D medical image segmentation, which are a significant obstacle to the reliable and accurate performance of DL models in real-world clinical settings. By investigating various sources of domain shifts, particularly in MRI and CT images, the thesis aims to develop robust methods that improve the generalization of segmentation models across different imaging domains. This work not only focuses on enhancing the performance of models through developing fine-tuning and domain adaptation (DA) methods but also introduces novel benchmarks and a dataset to ensure that these models can effectively handle out-of-distribution (OOD) data, which is critical for the safe deployment of deep learning (DL) in medical applications. To achieve the goal of the dissertation, the following problems are addressed:

\begin{enumerate}
    \item To investigate the domain shift effects on segmentation model performance, particularly in MRI and CT images.
    \item Develop and evaluate new robust methods to mitigate domain shifts, i.e., to improve the consistency and generalization of deep neural network segmentation models across varied imaging conditions.
    \item Establish benchmarks and datasets for DA and OOD detection in medical imaging to facilitate the evaluation and development of robust methods for 3D medical image segmentation.
    \item Examine existing DA and OOD detection methods and propose or indicate improvements.
\end{enumerate}


\underline{\textbf{Scientific novelty.}}%The scientific novelty is built up from the following results:
\begin{enumerate}
	\item A novel gradient-based method, SpotTUnet, was proposed and implemented to automatically identify and fine-tune the neural network layers most susceptible to domain shifts in supervised domain adaptation settings, improving segmentation performance under limited data availability.
	\item A knowledge-driven augmentation technique, Filtered Back-Projection Augmentation (FBPAug), was developed for the first time to simulate the effect of CT reconstruction kernel variability, significantly improving segmentation consistency.
	\item A data-driven unsupervised domain adaptation method, F-Consistency, was developed for the first time to address CT reconstruction kernel variability by enforcing feature map similarity between paired images. The method achieves state-of-the-art performance under kernel-induced domain shifts and establishes a foundation for future self-supervised learning approaches using FBPAug-generated pairs and the F-Consistency criterion.
	\item A large-scale benchmark, M3DA, was introduced for evaluating unsupervised domain adaptation methods in 3D medical image segmentation, revealing critical limitations of existing approaches – none of which close more than 61\% of the performance gap between source and target domains.
	\item A new publicly available dataset was collected and published for primary glioblastoma segmentation in radiotherapy planning. It allows for testing domain adaptation methods in the close to clinical scenarios.
	\item A benchmark for out-of-distribution detection in 3D medical imaging was constructed for the first time, containing multiple challenge scenarios and exposing critical limitations of existing OOD detection methods.
\end{enumerate}


\underline{\textbf{Theoretical and practical significance.}}
The developed methods, including SpotTUnet, FBPAug, and F-Consistency, demonstrate strong potential for improving the robustness of medical segmentation models across diverse imaging protocols and clinical environments. The introduced M3DA and OOD detection benchmarks provide systematic tools for evaluating domain adaptation and reliability of segmentation algorithms in real-world scenarios. Furthermore, the published Burdenko Glioblastoma Progression dataset offers a clinically relevant testbed for developing and validating domain adaptation methods in radiotherapy planning. Altogether, the results of this dissertation contribute to advancing the safe deployment of deep learning in clinical practice and help bridge the gap between algorithmic development and medical application.

The majority of methods and benchmarks have publicly available source code:

\begin{enumerate}
	% \fontsize{10pt}{11pt}\selectfont
	\item First-layers fine-tuning: \href{https://github.com/kechua/DART20}{https://github.com/kechua/DART20}
	\item Domain Shift Anatomy: \hfill \hfill \linebreak \href{https://github.com/neuro-ml/domain_shift_anatomy}{https://github.com/neuro-ml/domain\_shift\_anatomy}
	\item Filtered Back-Projection Augmentation: \hfill \hfill \linebreak \href{https://github.com/STNLd2/FBPAug}{https://github.com/STNLd2/FBPAug}
	\item M3DA benchmark: \href{https://github.com/BorisShirokikh/M3DA}{https://github.com/BorisShirokikh/M3DA}
	\item {Burdenko's Glioblastoma Progression Dataset: \hfill \hfill \linebreak \href{https://www.cancerimagingarchive.net/collection/burdenko-gbm-progression/}{cancerimagingarchive.net/collection/burdenko-gbm-progression/}}
	\item Benchmark for Out-of-distribution detection on 3D medical images: \hfill \linebreak \href{https://github.com/francisso/OOD-benchmark}{https://github.com/francisso/OOD-benchmark}
	\item Intensity Histogram Features algorithm: \hfill \hfill \linebreak \href{https://github.com/BorisShirokikh/MOOD\_submission\_Sample-level\_AIRI}{github.com/BorisShirokikh/MOOD\_submission\_Sample-level\_AIRI}
\end{enumerate}

In addition to being published and open-sourced, FBPAug has been integrated into multiple products at IRA Labs Ltd, including a COVID-19 segmentation algorithm registered as Intellectual Property\footnote{\href{https://www.fips.ru/registers-doc-view/fips\_servlet?DB=EVM\&DocNumber=2021612647}{https://www.fips.ru/registers-doc-view/fips\_servlet?DB=EVM\&DocNumber=2021612647}}, further demonstrating the practical significance of this work. The corresponding \underline{certificate of state registration of computer programs} could be found in Appendix~\ref{app:reg}.


\underline{\textbf{Research methodology.}} The research focuses on machine learning and deep learning techniques to solve the stated problems. Methodology also included methods of linear algebra, analysis, probability theory, mathematical statistics, numerical optimization methods, software development and mathematical models of computer tomography. Most of the methods are implemented in Python programming language and its low-level libraries.

\underline{\textbf{Propositions submitted for defense.}}

\begin{enumerate}
	\item A novel supervised domain adaptation method, SpotTUnet, was developed to automatically identify and fine-tune layers most affected by domain shift. The method improved segmentation performance in MRI across diverse clinical domains and provided interpretable insights into layer-wise shift susceptibility. Used as a visualization or guidance tool, SpotTUnet contributed to the development of the further proposed methods, such as F-Consistency and IHF.
	\item A knowledge-driven augmentation technique, FBPAug, was proposed to address domain shifts caused by different CT reconstruction kernels. The method significantly increased prediction consistency across paired reconstructions, improving Dice score from 0.46 to 0.76 in COVID-19 lung segmentation. Furthermore, FBPAug was used to develop most of the commercially used CT segmentation algorithms, significantly improving their robustness.
	\item A data-driven unsupervised adaptation method, F-Consistency, was introduced to leverage paired CT images reconstructed with different kernels. By enforcing feature map similarity, the method achieved state-of-the-art results in kernel-induced domain shift settings, further increasing Dice score to 0.80.
	\item The M3DA benchmark was constructed for the large-scale evaluation of unsupervised DA methods in 3D medical image segmentation. It comprises four publicly available datasets and eight clinically relevant domain shift setups, including shifts across modalities, acquisition protocols, and contrast settings.
	\item A new dataset, Burdenko’s Glioblastoma Progression (BGP), was collected and published to evaluate segmentation models in a realistic DA scenario. It includes multi-sequence MRI scans from 180 patients acquired across multiple clinical sites and scanner vendors, enabling testing under heterogeneous acquisition variability.
	\item A benchmark for OOD detection in 3D medical segmentation was proposed, containing several clinically relevant challenge cases. It revealed fundamental limitations of existing OOD methods and established practical evaluation criteria for real-world robustness assessment.
	\item An effective OOD detection method, Intensity Histogram Features (IHF), was developed. With the lowest computational cost, it achieved top-2 ranking in the Medical Out-of-Distribution Challenge (MOOD) 2022 and 2023, making it a strong baseline and analysis tool for domain shifts in 3D medical images.
\end{enumerate}


\underline{\textbf{Validity of the obtained results. Approbation.}} The statements and conclusions formulated in the dissertation have received qualified approbation at the following international and Russian scientific conferences:

\begin{enumerate}
	\item Domain Adaptation and Representation Transfer MICCAI 2020 Workshop. Lima, Peru, October 2020.
    \item Cross-Modality Domain Adaptation for Medical Image Segmentation (challenge-associated satellite event at MICCAI). Strasbourg, France, September 2021.
    \item Conference on Medical Image Computing and Computer Assisted Intervention (MICCAI). Strasbourg, France, September 2021.
    \item Information Technologies and Systems (ITaS) conference. November 2021.
    \item Medical Out-of-Distribution Analysis Challenge (challenge-associated satellite event at MICCAI). Singapore, September 2022.
    \item Information Technologies and Systems (ITaS) conference. Istra, Russia, September 2023.
\end{enumerate}

The reliability of the results is ensured by comprehensive experimental evaluation across multiple datasets, diverse experimental settings, and multiple methods of statistical analysis, with all validation procedures in accordance with the leading work in the area. The reproducibility of findings was validated through systematic benchmarking of multiple deep learning algorithms and repeated experiments to ensure statistical significance of the results. All the proposed methods are compared with existing methods for domain adaptation or OOD detection using measurable metrics.

The credibility is also confirmed by two publications of research results in Q1 peer-reviewed scientific journals, two publications in Q2 peer-reviewed journals, and three peer-reviewed conference proceedings, including one in proceedings of the Rank A conference. All of these journals and proceedings are indexed in Scopus and Web of Science.


\underline{\textbf{Personal contribution of the author.}}
The content of the dissertation and the main statements submitted for defense reflect the author’s personal contribution to the published works, obtained personally by the author or with his direct participation. The author’s contribution includes the formulation of research objectives, literature analysis, design and execution of extensive computational experiments, and interpretation of the obtained results. The dissertation aims and objectives were formulated jointly by the author, the author’s scientific supervisor, Prof. Ivan V. Oseledets, and Dr. Mikhail G. Belyaev (IRA Labs Ltd).

Preparation of the seven publications (four in peer-reviewed journals and three in conference proceedings) was carried out together with co-authors, with the author’s contribution being decisive. In particular, the author proposed the core methodologies for domain adaptation and out-of-distribution detection, developed experimental pipelines, and analyzed experimental results. Additionally, the author contributed to the development of a software product registered by the state and to the creation of a publicly available medical imaging dataset.
%All the results of the dissertation were obtained by the applicant personally. The applicant developed a deep learning structure-based method for identification of binding sites on macromolecules. The applicant is first on the author lists of all three major publications on the topic of the thesis.

%The content of the dissertation and the main statement submitted for defense reflect the author’s personal contribution to the published works and have been received personally by the author or with her direct participation. The author’s contribution includes setting research objectives, studying literature corresponding to the topic, designing and carrying out experiments, and analyzing the received results. The problem statements were formulated by A. Zaytsev, the author’s scientific supervisor, and the research results were discussed with the co-authors.

\underline{\textbf{Dissertation structure.}}
The dissertation consists of~an abstract, introduction, \formbytotal{totalchapter}{chapter}{}{s}{}, conclusions, lists of abbreviations, figures, tables, and \formbytotal{totalappendix}{appendix}{}{es}{}. The full volume of the dissertation is \formbytotal{TotPages}{page}{}{s}{s} with \formbytotal{totalcount@figure}{}{figure}{figures}{figures} and \formbytotal{totalcount@table}{}{table}{tables}{tables}. The list of references contains \formbytotal{citenum}{source}{}{s}{}.
%The thesis consists of an introduction, \totchapter chapters,  conclusion and three appendices.  The list of figures consists of \totfig\ items, the list of tables consists of \tottab\ items.
%The dissertation consists of an introduction, [number] chapters, and a conclusion. The dissertation is [number] pages long, including [number] figures, [number] algorithms, and [number] tables. The list of references contains [number] titles including [number] of publications by the author.

\underline{\textbf{Organization of the Dissertation.}}
The \underline{Introduction} substantiates the relevance of the work, formulates the research goals and problems, outlines the scientific novelty, and describes the methodology and practical significance of the results.
\underline{Chapter~\ref{chap:mri}} analyzes the internal sensitivity of convolutional neural networks to domain shifts in MRI segmentation. A gradient-based layer selection method (SpotTUnet) is proposed, allowing autonomous and interpretable fine-tuning under data-limited conditions.
\underline{Chapter~\ref{chap:ct}} addresses domain shifts arising from reconstruction kernel variability. Two novel approaches are developed: a theoretically grounded augmentation method (FBPAug) and an unsupervised adaptation framework (F-Consistency), both demonstrating state-of-the-art performance and practical applicability in clinical imaging.
\underline{Chapter~\ref{chap:da_bench}} introduces the large-scale M3DA benchmark for evaluating unsupervised domain adaptation in 3D medical image segmentation and presents the BGP dataset, offering a realistic “in-the-wild” validation scenario.
\underline{Chapter~\ref{chap:ood_bench}}  develops an evaluation framework for OOD detection in medical images and proposes a computationally efficient method, IHF, which achieves top-ranked results in international challenges.
The \underline{Conclusion} summarizes the main scientific results, their theoretical and practical significance, limitations, and outlines prospects for future research.
% (Domain Shift Anatomy)
% (Domain Adaptation in CT Images)
% (Benchmark for Domain Adaptation)
% (Benchmark for Out-of-Distribution Detection)



% Template and formatting:
% All Skoltech theses have an abstract
% One thesis had chapter summary at the end of each chapter. Looks like a good idea
% Introduction is apparently just a regular chapter
\input{common/characteristic}



